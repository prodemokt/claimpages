var noEmail = 0;
function loadScript(){

var emailAddressCount = 0;
var fsmContr = new FsmControler();
$('.submit').click(function(e){
	 fsmContr.beginAction('welcome', 'takeHome', 'container');
});

$('.forgotpwd').click(function(e){
	var id = e.currentTarget.id;
	var action = $('#'+id).data('action');
	fsmCont.performAction(action, 'bodycontent	');
});

$('.login').click(function(e){
	 var id = e.currentTarget.id;
	 var formid = $('#'+id).data('form');
	 fsmContr.loginAction(formid);
});

$('.loadpopup').click(function(e){
	$('#customerEmailAlert').modal('hide');
	var onStateChange = fsmCont.ON_STATE_CHANGE;
	if(onStateChange=="interrupt" && emailAddressCount == 0 && noEmail ==0) {
		leavePageWarning();
		noEmail ++;
		return false;
	}
	 $('#customerEmailAlert').modal('hide');
	 var id = e.currentTarget.id;
	 var url = $('#'+id).data('url');
	 var renderer = $('#'+id).data('cxtrenderer');
		if(renderer != null )
		  fsmcxt.setRenderer(renderer);
	 fsmCont.loadPagebyURL('./'+url);
	 emailAddressCount = 0;
});

$('.load').click(function(e){
	 var id = e.currentTarget.id;
	 var url = $('#'+id).data('url');
	 var renderer = $('#'+id).data('cxtrenderer');
		if(renderer != null )
		  fsmcxt.setRenderer(renderer);
	 fsmCont.loadPagebyURL('./'+url);
});

$('.headerlinkpopup').click(function(e){
	$('#customerEmailAlert').modal('hide');
	var onStateChange = fsmCont.ON_STATE_CHANGE;
	if(onStateChange=="interrupt" && emailAddressCount ==0 && noEmail ==0) {
		leavePageWarning();
		return false;
	}
	 $('#customerEmailAlert').modal('hide');
	fsmcxt.setRenderer('bodycontent');
	var id = e.currentTarget.id;
	var action = $('#'+id).data('action');
	var mach = $('#'+id).data('mach');
	var key = $('#'+id).data('key');	
	var value = $('#'+id).data('value');
	 indexfsmCont.setLocalValue(key, value);
	indexfsmCont.beginAction(mach ,action);
	emailAddressCount = 0;
	
});
$('.headerlinkpopupsignout').click(function(e){
	$('#customerEmailAlert').modal('hide');
	var onStateChange = fsmCont.ON_STATE_CHANGE;
	if(onStateChange=="interrupt" && emailAddressCount ==0 && noEmail ==0) {
		leavePageWarning();
		return false;
	}
	 $('#customerEmailAlert').modal('hide');
	fsmcxt.setRenderer('bodycontent');
	var id = e.currentTarget.id;
	var action = $('#'+id).data('action');
	var mach = $('#'+id).data('mach');
	var key = $('#'+id).data('key');	
	var value = $('#'+id).data('value');
	 indexfsmCont.setLocalValue(key, value);
	 window.location.href='signout';
	//indexfsmCont.beginAction(mach ,action);
	emailAddressCount = 0;
	
});

$('.headerlink').click(function(e){
	fsmcxt.setRenderer('bodycontent');
	var id = e.currentTarget.id;
	var action = $('#'+id).data('action');
	var mach = $('#'+id).data('mach');
	var key = $('#'+id).data('key');	
	var value = $('#'+id).data('value');
	 indexfsmCont.setLocalValue(key, value);
	indexfsmCont.beginAction(mach ,action);
});

function leavePageWarning() {
	$('#customerEmailAlert').modal('show');
	emailAddressCount ++;
}

function emailCount() {
	emailAddressCount ++;
}

$('.hasemail').click(function(e){
	noEmail = 0;
	 $('#customerEmailAlert').modal('hide');
});

$('.noemail').click(function(e){
	emailCount();
	noEmail = 1;
	 $('#customerEmailAlert').modal('hide');
});

$('#user').click(function(e){
	autoFill();
});

$('.switchclient').click(function(e) {
	$('#customerEmailAlert').modal('hide');
	var onStateChange = fsmCont.ON_STATE_CHANGE;
	if(onStateChange=="interrupt" && emailAddressCount==0 && noEmail ==0) {
		leavePageWarning(); 
		return false;
	}
	$('#customerEmailAlert').modal('hide');
	var id = e.currentTarget.id;
	var key = $(this).data('key');
	var value = $(this).data('value');
	fsmCont.clearLocalVars();
	fsmCont.setLocalValue(key, value);
	fsmCont.beginAction('welcome', 'setclient', 'container');
	emailAddressCount = 0;
});

$('.menulinkpopup').click(function(e){
	$('#customerEmailAlert').modal('hide');
	var onStateChange = fsmCont.ON_STATE_CHANGE;
	if(onStateChange=="interrupt" && emailAddressCount==0 && noEmail ==0) {
		leavePageWarning(); 
		return false;
	}
	 $('#customerEmailAlert').modal('hide');
	fsmcxt.setRenderer('bodycontent');
	var id = e.currentTarget.id;
	var mach = $('#'+id).data('mach');
	var action = $('#'+id).data('action');
	 var key = $('#'+id).data('key');	
	 var value = $('#'+id).data('value');
	 indexfsmCont.setLocalValue(key, value);
	indexfsmCont.beginAction(mach,action);
	emailAddressCount = 0;
});

$('.menulink').click(function(e){
	fsmcxt.setRenderer('bodycontent');
	var id = e.currentTarget.id;
	var mach = $('#'+id).data('mach');
	var action = $('#'+id).data('action');
	 var key = $('#'+id).data('key');	
	 var value = $('#'+id).data('value');
	 indexfsmCont.setLocalValue(key, value);
	indexfsmCont.beginAction(mach,action);
});

$('.performAction').click(function(e){
	 var id = e.currentTarget.id;
	 var action = $('#'+id).data('action');
	 var key = $('#'+id).data('key');
	 var value = $('#'+id).data('value');
	 var renderer = $('#'+id).data('cxtrenderer');
	 var validation = $('#'+id).data('validate');
	 var boolean = true;
	 if(validation != null){
		 if (typeof window[validation] === 'function'){
			 boolean = window[validation]();
		 }
	 }	
	if(boolean){
	 fsmCont.setLocalValue(key, value);
	 var json = $('#'+id).data('json');
	 if(json!=null){
		addJson(json);
	 }
	 if(renderer != null)
	    fsmcxt.setRenderer(renderer);
	 fsmCont.performAction(action);
	}
});

$('.beginAction').click(function(e){
	 var id = e.currentTarget.id;
	 var mach = $('#'+id).data('mach');
	 var action = $('#'+id).data('action');
	 var key = $('#'+id).data('key');
	 var value = $('#'+id).data('value');
	 var renderer = $('#'+id).data('cxtrenderer');
	 if(renderer != null)
		 fsmcxt.setRenderer(renderer);
	 
	 fsmCont.setLocalValue(key, value);
	 fsmCont.beginAction(mach, action);
});

$('.back').click(function(e){
	var id = e.currentTarget.id;
    var action = $('#'+id).data('action');
    fsmCont.performAction(action);
});

$('.viewpage').click(function(e){
	var id = e.currentTarget.id;
	var mach = $('#'+id).data('mach');
    var action = $('#'+id).data('action');
	var key = $('#'+id).data('key');
	var value = $('#'+id).data('value');
	var renderer = $('#'+id).data('cxtrenderer');
	 var validation = $('#'+id).data('validate');
	 var boolean = true;
	 if(validation != null){
		 if (typeof window[validation] === 'function'){
			 boolean = window[validation]();
		 }
	 }	
	if(boolean){
		if(renderer != null ){	
		fsmcxt.setRenderer(renderer);
		}
    fsmCont.setLocalValue(key, value);
    if(mach != null)
      fsmCont.beginAction(mach,action);
    else
      fsmCont.performAction(action);
	}
	
});

$('.onchange').change(function(e){
    var id = e.currentTarget.id;
    var action = $('#'+id).data('action');
    fsmCont.performAction(action);
});

$('.popupwindow').click(function(e){
	var id = e.currentTarget.id;
	var url = $('#'+id).data('url');
	var tweak = (new Date()).getTime();
	url = url + "&__tweak=" + tweak;
	window.showModalDialog("./modal_opener.jsp?"+url,window.top,"dialogTop:200px; dialogHeight:100px; dialogLeft:600px; dialogWidth:600px;  status:yes; scrollbars:yes; resizable:yes;");
});

$('.openwindow').click(function(e){
	var id = e.currentTarget.id;
	var url = $('#'+id).data('url');
	var load = $('#'+id).data('load');
	fsmCont.openPopup(url, load);
});

$('.openmodal').click(function(e){
	if(fsmcxt.isModelOpen())
		return;
	fsmcxt.setModelStatus(true);
	fsmcxt.updateObj(fsmCont.prepareReqParamObject());
	var id = e.currentTarget.id;
	var url = $('#'+id).data('url');
	fsmcxt.updateoldrenderer(fsmcxt.getRenderer());
	fsmcxt.setRenderer('modal-bodycontent');
	fsmCont.openModal(url);
});

$('.openpdf').click(function(e){	
	var id = e.currentTarget.id;
	var url = $('#'+id).data('url');	
	fsmCont.openModalPdf(url);
});

$('.download').click(function(e){
	var id = e.currentTarget.id;
	var url = $('#'+id).data('url');
	fsmCont.downloadFile(url);
});

$('.sort').click(function(e){
	var id = e.currentTarget.id;
    var action = $('#'+id).data('action');
    var order = $('#'+id).data('order');
    var colInd=$('#'+id).data('colind');
    var renderer = $('#'+id).data('cxtrenderer');	
	 if(renderer != null)
	    fsmcxt.setRenderer(renderer);
    if(colInd != undefined){
    	fsmCont.setLocalValue("ColumnIndex", colInd);
    }
    if(order != undefined){
    	fsmCont.setLocalValue("order", order);
    }
    fsmCont.performAction(action);
});

$('.checkboxinfo').click(function(e){
	 var id = e.currentTarget.id;
	 var name = $('#'+id).data('name');
	 var action = $('#'+id).data('action');
	 var selectedIDs = [];
		var itemSelected = false;
		for(i=0; i < document.getElementsByName(name).length ; i++){
			if(document.getElementsByName(name)[i].checked){
				itemSelected = true;
				selectedIDs[selectedIDs.length] = document.getElementsByName(name)[i].value;
			}
		}
		if(itemSelected){
			var val = "";
			for(var i=0;i<selectedIDs.length;i++)
				val+=selectedIDs[i]+",";
				
			 fsmCont.setLocalValue('removeItemIDs', val);
		}else{
			$('#myModalNewsList').modal();
			return;
		}
	 
	 fsmCont.performAction(action);
});

$('.click').change(function(e){
	var prodCode = e.currentTarget.checked;
	var id = e.currentTarget.id;
	if(prodCode){
		$("[id='row_" + id + "']").show();
	}else{
		$("[id='row_" + id + "']").hide();
	}
});

function addJson(json){
	var jobj =json.split(",");
	for(var i=0;i<jobj.length;i++){
		var keyvalue=jobj[i].split("=");
        fsmCont.setLocalValue(keyvalue[0], keyvalue[1]);
	}
}

$('.showhide').click(function(e) {
	  var id = e.currentTarget.id;
	  var tableId = $('#'+id).data('tabid');
	  if ($('#'+tableId).css('display') == "none") {
		  $('#'+tableId).css('display', '');
	  	  $('#'+id).removeClass('no-red');
	  	  $('#'+id).addClass('yes-green');	
	  	  
	  	  $('#'+id).removeClass('far fa-plus-square font-weight-normal');
	  	  $('#'+id).addClass('far fa-minus-square');
	  }
    else {
  	  $('#'+tableId).css('display', 'none');
      $('#'+id).removeClass('yes-green');
	  $('#'+id).addClass('no-red');
	  
	  $('#'+id).removeClass('far fa-minus-square');
	  $('#'+id).addClass('far fa-plus-square font-weight-normal');
	}
});


$('.multifileattach').click(function(e){
	 var id = e.currentTarget.id;	 	
	 var action = $('#'+id).data('action');
	 var fileid = $('#'+id).data('file');
	 var enctype = $('#'+id).data('enctype');
	 var renderer = $('#'+id).data('cxtrenderer');
	 var json = $('#'+id).data('json');
	 if(json!=null){
		addJson(json);
	 }		
	 if(renderer != null)
	    fsmcxt.setRenderer(renderer);
	 fsmCont.setLocalValue("ClientKey", $('select[name="Client"]').val());
	 fsmCont.setLocalValue("encoding", enctype);
	 var claimNo = $('.display_'+fsmCont.getLocalValue('AttachmentDisplayName')).val();
	if(claimNo !=  undefined ) {
		if(claimNo == ""){
	 	$('#'+fsmCont.getLocalValue('AttachmentDisplayName')).html('<i class="fas fa-exclamation-triangle error-msg" title="please select"></i> please select');
	 	return;
	 }else{
	 	fsmCont.setLocalValue("belongsToInnerClaimNo",claimNo);	 
	 }
	}else if($('#belongsToInnerClaimNo')[0] && fsmCont.getLocalValue('belongsToInnerClaimNo') == undefined || fsmCont.getLocalValue('belongsToInnerClaimNo') =="" ){
		$('#belongsToInnerClaimNo').html('<i class="fas fa-exclamation-triangle error-msg" title="please select"></i> please select');
		return;
	}
		 fsmCont.uploadAction(id, action , fileid);	
	 	 
});


$('.showclaimdiv').click(function(e){
	 var id = e.currentTarget.id;
	 var group = $('#'+id).data('group');
	 var tdElmArr= document.getElementsByTagName("div");
	  for(var i=0;i<tdElmArr.length;i++){
	    if(tdElmArr[i].id=='')
	      continue;
	    var elmId = new String(tdElmArr[i].id);
	    if(group != " "){
	     if(elmId.indexOf('div_claim_')!=-1){
	    	if(elmId.indexOf('div_claim_'+group)!=-1)
	    		tdElmArr[i].style.display='block';
	    	else
	    		tdElmArr[i].style.display='none'; 
	    }
	   }else{
		   if(elmId.indexOf('div_claim_')!=-1)
	    	tdElmArr[i].style.display='block';
	    	}
	    
	   }
	});
$('#modalClosedirect').click(function(e){
	fsmcxt.setModelStatus(false);
	fsmcxt.rollbackObj();
	fsmcxt.rollbackoldrenderer();
	$('#myModal').modal('hide');
	$( "body" ).addClass( "overflow-auto" );
});
$('.toggleDispalyClaim').click(function(e){
	var id = e.currentTarget.id;
	var claimNo =$('#'+id).data('value');
	if($('#div_'+claimNo).css('display') != 'none'){
		$('#div_'+claimNo).css('display','none');
	}else{
		$('#div_'+claimNo).css('display','block');
	} 
});

/* 
------------------------------------
 tooltip only on ellipsis starts
------------------------------------
 */
/*$(function () {
    $('.elptool').each(function(i) {
        if (isEllipsisActive(this)) {
            $(this).attr("data-original-title", $(this).text());
        }
    });
});*/
$(window).on("resize",function(e){
	$('.elptool').each(function(i) {
        if (isEllipsisActive(this)) {
            $(this).attr("data-bs-original-title", $(this).text());
        }else{
        	$(this).removeAttr("data-bs-original-title");
        }
    });
});

$( ".elptool" ).mouseover(function() {
	$('.elptool').each(function(i) {
        if (isEllipsisActive(this)) {
            $(this).attr("data-bs-original-title", $(this).text());
        }else{
        	$(this).removeAttr("data-bs-original-title");
        }
    });
});
function isEllipsisActive(e) {
    return (e.offsetWidth <  e.scrollWidth);
}
/* 
------------------------------------
 tooltip only on ellipsis end
------------------------------------
 */

$(document).keypress(function(e) {
	if(e.target.type != "button"  &&  e.target.type != "" && e.which == 13){
		  var type = $(document.activeElement)[0].type;
		  var defaultRenderer = fsmcxt.getRenderer();		
		if(defaultRenderer!="" && type != 'select-one' && type != 'textarea'){
			//var classList = $('#'+defaultRenderer).find('.enterkey')[0].classList;
			//var action = $('#'+defaultRenderer).find('.enterkey')[0].dataset.action;
			var key = $('#'+defaultRenderer).find('.enterkey')[0].dataset.key;
			var value = $('#'+defaultRenderer).find('.enterkey')[0].dataset.value;			
			 fsmCont.setLocalValue(key, value);
			 var json = $('#'+defaultRenderer).find('.enterkey')[0].dataset.json;
			 if(json!=null){
				addJson(json);
			 }
			 var renderer = $('#'+defaultRenderer).find('.enterkey')[0].dataset.cxtrenderer;
			 if(renderer != null)
			    fsmcxt.setRenderer(renderer);			 				 
			 $('#'+defaultRenderer).find(".enterkey").trigger("click");
		}
	  }
});

$(".downloadfile").click(function(e){
	var id = e.currentTarget.id;
	var url = $('#'+id).data('url');
	window.open(url,'Downlaod','v');
	});

//this is for notes 
$('.showhidefornotes').click(function(e) {
	var noteid = e.currentTarget.id;	
	 var tableId = $('#'+noteid).data('tabid');
	  if($('#notetext_short_'+tableId).css('display') == 'none'){
		  $('#notetext_short_'+tableId).css('display','block');
	      $('#notetext_full_'+tableId).css('display','none');	         	     
	  }else{
		  $('#notetext_full_'+tableId).css('display','block');
		  $('#notetext_short_'+tableId).css('display','none');		  		 
	  }
	});

$('.viewer').click(function(e){
	var id = e.currentTarget.id;
	//var url = $('#'+id).data('url');
	var json = $('#'+id).data('json');
	fsmCont.openViewer(encrptJson(json));
});

function encrptJson(json){
	var queryString = "";
	var params =json.split(",");
	for(var i=0;i<params.length;i++){
		var keyvalue=params[i].split("=");
		if(i == 0)
			queryString = queryString + keyvalue[0] +'='+ encodeURIComponent("/"+keyvalue[1]+"/");
		else
			queryString = queryString +'&'+ keyvalue[0] +'='+ encodeURIComponent("/"+keyvalue[1]+"/");
	}
	return queryString;
}


$(".table-recordfix").scroll(function(){
	var w = $(this).find("table").width();
	$(".tbl-records").css("width",w);
});
$('.multifileattachgapclaim').click(function(e){
	 var id = e.currentTarget.id;	 	
	 var action = $('#'+id).data('action');
	 var fileid = $('#'+id).data('file');
	 var enctype = $('#'+id).data('enctype');
	 var renderer = $('#'+id).data('cxtrenderer');
	 var json = $('#'+id).data('json');
	 if(json!=null){
		addJson(json);
	 }		
	 if(renderer != null)
	    fsmcxt.setRenderer(renderer);
	 fsmCont.setLocalValue("ClientKey", $('select[name="Client"]').val());
	 fsmCont.setLocalValue("encoding", enctype);
	 var claimNo = fsmCont.getLocalValue('belongsToInnerClaimNo');
	 if(claimNo==""||claimNo ==  undefined )
	 var claimNo = $('#belongsToInnerClaimNoToDisplay :selected').text();
	 
	if(claimNo !=  undefined ) {
		if(claimNo == ""){
	 	$('#'+fsmCont.getLocalValue('AttachmentDisplayName')).html('<i class="fas fa-exclamation-triangle error-msg" title="please select"></i> please select');
	 	return;
	 }else{
	 	fsmCont.setLocalValue("belongsToInnerClaimNo",claimNo);	 
	 }
	}else if($('#belongsToInnerClaimNo')[0] && fsmCont.getLocalValue('belongsToInnerClaimNo') == undefined || fsmCont.getLocalValue('belongsToInnerClaimNo') =="" ){
		$('#belongsToInnerClaimNo').html('<i class="fas fa-exclamation-triangle error-msg" title="please select"></i> please select');
		return;
	}
		 fsmCont.uploadAction(id, action , fileid);	
	 	 
});
$('.performActionforAssesments').click(function(e){
	 var id = e.currentTarget.id;
	 var action = $('#'+id).data('action');
	 var key = $('#'+id).data('key');
	 var value = $('#'+id).data('value');
	 var renderer = $('#'+id).data('cxtrenderer');
	 var validation = $('#'+id).data('validate');
	 var boolean = true;
	 if(validation != null){
		 if (typeof window[validation] === 'function'){
			 boolean = window[validation]();
		 }
	 }	
	if(boolean){
	 fsmCont.setLocalValue(key, value);
	 var json = $('#'+id).data('json');
	 if(json!=null){
		addJson(json);
	 }
	 if(renderer != null)
	    fsmcxt.setRenderer(renderer);
	 fsmCont.performAction(action);
	}
});
$('.performActionOuter').click(function(e){
	 var id = e.currentTarget.id;
	 var action = $('#'+id).data('action');
	 var key = $('#'+id).data('key');
	 var value = $('#'+id).data('value');
	 var renderer = $('#'+id).data('cxtrenderer');
	 var validation = $('#'+id).data('validate');
	 var boolean = true;
	 if(validation != null){
		 if (typeof window[validation] === 'function'){
			 boolean = window[validation]();
		 }
	 }	
	if(boolean){
	 fsmCont.setLocalValue(key, value);
	 var json = $('#'+id).data('json');
	 if(json!=null){
		addJson(json);
	 }
	 if(renderer != null)
	    fsmcxt.setRenderer(renderer);
	 fsmCont.performAction(action);
	}
});
/*$('#logout').click(function(e){
	var url = window.location.href;
	$(location).attr('href', url); 
	
});*/
}// end of loadscript()

function welcomeUser1(username) {
		indexfsmCont.loginAction(username);
}



